# dtype
dtype: 'float32'

# Pressure filter
pressure_filter:
  load:
    _target_: inverse.data.filters.pressure_filter
    prof:
      _target_: utilities.io.load_stack_and_normalize
      _recursive_: false
      stack:
        - load: ${data.stage.train.vars.prof.load}
          normalization:
            _target_: inverse.data.transformations.min_max
            _partial_: true
            stats:
              _target_: inverse.data.statistics.read_statistics_var
              path: ${preparation.statistics.data.output.path}
              var: 'prof'
              dtype: ${data.dtype}
            axis: null
        - load: ${data.stage.valid.vars.prof.load}
          normalization:
            _target_: inverse.data.transformations.min_max
            _partial_: true
            stats:
              _target_: inverse.data.statistics.read_statistics_var
              path: ${preparation.statistics.data.output.path}
              var: 'prof'
              dtype: ${data.dtype}
            axis: null
        - load: ${data.stage.test.vars.prof.load}
          normalization:
            _target_: inverse.data.transformations.min_max
            _partial_: true
            stats:
              _target_: inverse.data.statistics.read_statistics_var
              path: ${preparation.statistics.data.output.path}
              var: 'prof'
              dtype: ${data.dtype}
            axis: null

# Split the data into training, validation, and test sets
stage:
  # Training set
  train:
    # Path to training data
    dir: ${paths.data_dir}/Train2
    # Split
    split:
      _target_: ${data.stage.train.vars.cloud_filter.load._target_}
      _args_:
        - _target_: ${data.stage.train.vars.prof.load._target_}
          path: ${data.stage.train.vars.prof.load.path}
    # Variables
    vars:
      # Latitude
      lat:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lat.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization:
          _target_: inverse.data.transformations.min_max
          _partial_: true
          stats:
            _target_: inverse.data.statistics.read_statistics_var
            path: ${preparation.statistics.data.output.path}
            var: 'lat'
            dtype: ${data.dtype}
      # Longitude
      lon:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lon.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization:
          _target_: inverse.data.transformations.min_max
          _partial_: true
          stats:
            _target_: inverse.data.statistics.read_statistics_var
            path: ${preparation.statistics.data.output.path}
            var: 'lon'
            dtype: ${data.dtype}
      # Scans
      scans:
        # Loading function
        load:
          _target_: utilities.io.load_scans
          path: ${....dir}/scans.txt
          lat:
            _target_: ${....lat.load._target_}
            path: ${....lat.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization:
          _target_: inverse.data.transformations.min_max
          _partial_: true
          stats:
            _target_: inverse.data.statistics.read_statistics_var
            path: ${preparation.statistics.data.output.path}
            var: 'scans'
            dtype: ${data.dtype}
      # Pressure
      pressure:
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/pressure.npy
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization:
          _target_: inverse.data.transformations.min_max
          _partial_: true
          stats:
            _target_: inverse.data.statistics.read_statistics_var
            path: ${preparation.statistics.data.output.path}
            var: 'pressure'
            dtype: ${data.dtype}
      # Atmospheric profiles
      prof:
        # Profile types
        type: [ 'Air temperature', 'Water vapor mixing ratio', 'Cloud ice mass', 'Cloud water mass', 'Snow mass',
                'Ice particle effective radius', 'Water particle effective radius',
                'Snow particle effective radius', 'Ozone mixing ratio' ]
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/prof.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization:
          _target_: inverse.data.transformations.min_max
          _partial_: true
          stats:
            _target_: inverse.data.statistics.read_statistics_var
            path: ${preparation.statistics.data.output.path}
            var: 'prof'
            dtype: ${data.dtype}
          axis: 1  # null
      # Surface variables
      surf:
        # Surface variable types
        type: [ 'Ice area fraction', 'Land area fraction', 'Land type', 'Leaf area index', 'Soil temperature',
                'Snow area fraction', 'Snow thickness', 'Soil temperature',
                'Surface temperature (ice, land, sea, snow)', 'Wind direction', 'Wind speed',
                'Vegetation area fraction', 'Water area fraction', 'Volumetric water ratio (soil)' ]
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/surf.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization:
          _target_: forward.data.transformations.NormalizeSurface
          surfmax:
            _target_: numpy.loadtxt
            _args_:
              - forward/data/normalization/surfmax.txt
          surfmin:
            _target_: numpy.loadtxt
            _args_:
              - forward/data/normalization/surfmin.txt
          dtype: ${data.dtype}
      # Metadata
      meta:
        # Metadata variable types
        type: [ 'Sensor scan angle', 'Sensor zenith angle', 'Sensor view angle', 'Sensor azimuth angle',
                'Sensor elevation angle', 'Solar azimuth angle', 'Solar zenith angle' ]
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/meta.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization:
          _target_: forward.data.transformations.NormalizeMeta
          settings:
            meta_cos_vars: [ 6 ]
            meta_scale_factor: 180
            meta_scale_offset: -180
            meta_scale_vars: [ ]
            meta_sin_vars: [ 0, 1, 2, 3, 4, 5 ]
      # Brightness temperatures
      hofx:
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/predict_hofx.npy
          split: ${....split}
          dtype: ${data.dtype}
      # Cloud filter
      cloud_filter:
        # Loading function
        load:
          _target_: inverse.data.filters.cloud_filter
          _args_:
            - ${....prof.load}
      # Atmospheric profile background
      prof_background:
        # Loading function
        load:
          _target_: inverse.data.covariance.background_climatology
          data: ${...prof.load}
        # Normalization function and parameters
        normalization: ${..prof.normalization}
      # Atmospheric profile increment
      prof_increment:
        # Loading function
        load:
          _target_: inverse.data.covariance.background_increment
          config_true: ${...prof}  # We use the normalized true profiles
          config_background: ${...prof_background}  # We use the normalized background profiles
      # Brightness temperature innovation
      hofx_innovation:
        # Loading function
        load:
          _target_: inverse.data.covariance.innovation_uncertainty
          data: ${...hofx.load}

  # Validation set
  valid:
    # Path to validation data
    dir: ${paths.data_dir}/Val2
    # Split
    split:
      _target_: ${data.stage.valid.vars.cloud_filter.load._target_}
      _args_:
        - _target_: ${data.stage.valid.vars.prof.load._target_}
          path: ${data.stage.valid.vars.prof.load.path}
    # Variables
    vars:
      # Latitude
      lat:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lat.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.lat.normalization}
      # Longitude
      lon:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lon.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.lon.normalization}
      # Scans
      scans:
        # Loading function
        load:
          _target_: utilities.io.load_scans
          path: ${....dir}/scans.txt
          lat:
            _target_: ${....lat.load._target_}
            path: ${....lat.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.scans.normalization}
      # Pressure
      pressure:
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/pressure.npy
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.pressure.normalization}
      # Atmospheric profiles
      prof:
        # Profile types
        type: ${data.stage.train.vars.prof.type}
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/prof.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.prof.normalization}
      # Surface variables
      surf:
        # Surface variable types
        type: ${data.stage.train.vars.surf.type}
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/surf.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.surf.normalization}
      # Metadata
      meta:
        # Metadata variable types
        type: ${data.stage.train.vars.meta.type}
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/meta.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.meta.normalization}
      # Brightness temperatures
      hofx:
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/predict_hofx.npy
          split: ${....split}
          dtype: ${data.dtype}
      # Cloud filter
      cloud_filter:
        # Loading function
        load:
          _target_: inverse.data.filters.cloud_filter
          _args_:
            - ${....prof.load}
      # Atmospheric profile background
      prof_background:
        # Loading function
        load:
          _target_: inverse.data.covariance.background_climatology
          data: ${...prof.load}
        # Normalization function and parameters
        normalization: ${..prof.normalization}
      # Atmospheric profile increment
      prof_increment:
        # Loading function
        load:
          _target_: inverse.data.covariance.background_increment
          config_true: ${...prof}  # We use the normalized true profiles
          config_background: ${...prof_background}  # We use the normalized background profiles
      # Brightness temperature innovation
      hofx_innovation:
        # Loading function
        load:
          _target_: inverse.data.covariance.innovation_uncertainty
          data: ${...hofx.load}

  # Test set
  test:
    # Path to test data
    dir: ${paths.data_dir}/Test2
    # Split
    split:
      _target_: ${data.stage.test.vars.cloud_filter.load._target_}
      _args_:
        - _target_: ${data.stage.test.vars.prof.load._target_}
          path: ${data.stage.test.vars.prof.load.path}
    # Variables
    vars:
      # Latitude
      lat:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lat.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.lat.normalization}
      # Longitude
      lon:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lon.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.lon.normalization}
      # Scans
      scans:
        # Loading function
        load:
          _target_: utilities.io.load_scans
          path: ${....dir}/scans.txt
          lat:
            _target_: ${....lat.load._target_}
            path: ${....lat.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.scans.normalization}
      # Pressure
      pressure:
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/pressure.npy
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.pressure.normalization}
      # Atmospheric profiles
      prof:
        # Profile types
        type: ${data.stage.train.vars.prof.type}
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/prof.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.prof.normalization}
      # Surface variables
      surf:
        # Surface variable types
        type: ${data.stage.train.vars.surf.type}
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/surf.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.surf.normalization}
      # Metadata
      meta:
        # Metadata variable types
        type: ${data.stage.train.vars.meta.type}
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/meta.npy
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.meta.normalization}
      # Brightness temperatures
      hofx:
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/predict_hofx.npy
          split: ${....split}
          dtype: ${data.dtype}
      # Cloud filter
      cloud_filter:
        # Loading function
        load:
          _target_: inverse.data.filters.cloud_filter
          _args_:
            - ${....prof.load}
      # Atmospheric profile background
      prof_background:
        # Loading function
        load:
          _target_: inverse.data.covariance.background_climatology
          data: ${...prof.load}
        # Normalization function and parameters
        normalization: ${..prof.normalization}
      # Atmospheric profile increment
      prof_increment:
        # Loading function
        load:
          _target_: inverse.data.covariance.background_increment
          config_true: ${...prof}  # We use the normalized true profiles
          config_background: ${...prof_background}  # We use the normalized background profiles
      # Brightness temperature innovation
      hofx_innovation:
        # Loading function
        load:
          _target_: inverse.data.covariance.innovation_uncertainty
          data: ${...hofx.load}

  # Prediction set (NOTE: By default, we use the test set as the prediction set for demonstration purposes)
  predict:
    # Path to prediction data
    dir: ${paths.data_dir}/Test2
    # Split
    split: ${data.stage.test.split}
    # Variables
    vars:
      # Latitude
      lat:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lat.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.lat.normalization}
      # Longitude
      lon:
        # Loading function
        load:
          _target_: utilities.io.load_latlon
          path: ${....dir}/lon.npy
          scans:
            _target_: ${....scans.load._target_}
            path: ${....scans.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.lon.normalization}
      # Scans
      scans:
        # Loading function
        load:
          _target_: utilities.io.load_scans
          path: ${....dir}/scans.txt
          lat:
            _target_: ${....lat.load._target_}
            path: ${....lat.load.path}
          split: ${....split}
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.scans.normalization}
      # Pressure
      pressure:
        # Loading function
        load:
          _target_: utilities.io.load_npy
          path: ${....dir}/pressure.npy
          dtype: ${data.dtype}
        # Normalization function and parameters
        normalization: ${data.stage.train.vars.pressure.normalization}